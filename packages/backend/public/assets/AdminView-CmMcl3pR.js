import{q as y,e as F,o as c,c as p,a as t,t as w,i as V,s as d,v,A as D,B as M,f as C,C as N,F as U,x as A,g as S,b as q}from"./vendor-D2h_NbJw.js";import{_ as x,u as H}from"./index-BWLtSEKQ.js";import{a as k,E as L}from"./EventCard-5brpXagm.js";const O={class:"modal-dialog"},_={class:"modal-content"},R={class:"modal-header"},j={class:"modal-title"},K={class:"modal-body"},z={class:"col-12"},P={class:"col-md-6"},G={class:"col-md-6"},J={class:"col-md-6"},Q={class:"col-md-6"},W={class:"col-md-6"},X={class:"col-md-6"},Y={class:"col-md-6"},Z={class:"col-12"},ee={class:"form-check"},te={class:"modal-footer"},oe=["disabled"],se={__name:"EventForm",props:{event:{type:Object,required:!0},loading:{type:Boolean,default:!1}},emits:["save","close"],setup(T,{emit:m}){const a=T,u=m,i=y({title:"",date:"",startTime:"",location:"",room:"",duration:60,maxBookings:1,price:0,visibility:!0});F(()=>{const s={title:a.event.title||"",date:"",startTime:"",location:a.event.location||"",room:a.event.room||"",duration:a.event.duration||60,maxBookings:a.event.maxBookings||1,price:a.event.price||0,visibility:a.event.visibility!==!1};if(console.log("Initial event data:",s),a.event.date){const e=new Date(a.event.date);s.date=e.toLocaleDateString("sv").split("T")[0]}if(a.event.startTime)if(a.event.startTime.includes(":")&&!a.event.startTime.includes("T"))s.startTime=a.event.startTime,console.log("Time already in HH:MM format:",s.startTime);else{const e=new Date(a.event.startTime);if(isNaN(e.getTime()))console.warn("Invalid time format:",a.event.startTime),s.startTime="";else{const l=e.getHours().toString().padStart(2,"0"),b=e.getMinutes().toString().padStart(2,"0");s.startTime=`${l}:${b}`,console.log("Converted time to HH:MM:",s.startTime)}}i.value=s,console.log("Final form data:",i.value)});const f=()=>{const s={...i.value};console.log("Form data before submit:",s);try{if(s.duration=parseInt(s.duration),s.maxBookings=parseInt(s.maxBookings),s.price=parseFloat(s.price),s.date&&s.startTime){const[e,l]=s.startTime.split(":"),b=new Date(s.date);b.setHours(parseInt(e),parseInt(l),0,0),s.date=b.toISOString().split("T")[0],s.startTime=b.toISOString(),console.log("Formatted date and time:",{date:s.date,startTime:s.startTime})}u("save",s)}catch(e){throw console.error("Error formatting form data:",e),e}};return(s,e)=>(c(),p("div",O,[t("div",_,[t("div",R,[t("h5",j,w(T.event.id?"Termin bearbeiten":"Neuen Termin erstellen"),1),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=l=>s.$emit("close"))})]),t("div",K,[t("form",{onSubmit:V(f,["prevent"]),class:"row g-3"},[t("div",z,[e[11]||(e[11]=t("label",{class:"form-label"},"Titel",-1)),d(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.title=l),type:"text",class:"form-control",required:""},null,512),[[v,i.value.title]])]),t("div",P,[e[12]||(e[12]=t("label",{class:"form-label"},"Datum",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.date=l),type:"date",class:"form-control",required:""},null,512),[[v,i.value.date]])]),t("div",G,[e[13]||(e[13]=t("label",{class:"form-label"},"Startzeit",-1)),d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.startTime=l),type:"time",class:"form-control",required:""},null,512),[[v,i.value.startTime]])]),t("div",J,[e[14]||(e[14]=t("label",{class:"form-label"},"Ort",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.location=l),type:"text",class:"form-control"},null,512),[[v,i.value.location]])]),t("div",Q,[e[15]||(e[15]=t("label",{class:"form-label"},"Raum",-1)),d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>i.value.room=l),type:"text",class:"form-control"},null,512),[[v,i.value.room]])]),t("div",W,[e[16]||(e[16]=t("label",{class:"form-label"},"Dauer (Minuten)",-1)),d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>i.value.duration=l),type:"number",class:"form-control",min:"1",required:""},null,512),[[v,i.value.duration,void 0,{number:!0}]])]),t("div",X,[e[17]||(e[17]=t("label",{class:"form-label"},"Max. Buchungen",-1)),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>i.value.maxBookings=l),type:"number",class:"form-control",min:"1",required:""},null,512),[[v,i.value.maxBookings,void 0,{number:!0}]])]),t("div",Y,[e[18]||(e[18]=t("label",{class:"form-label"},"Preis (€)",-1)),d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>i.value.price=l),type:"number",class:"form-control",min:"0",step:"0.01",required:""},null,512),[[v,i.value.price,void 0,{number:!0}]])]),t("div",Z,[t("div",ee,[d(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>i.value.visibility=l),type:"checkbox",class:"form-check-input",id:"visibility"},null,512),[[D,i.value.visibility]]),e[19]||(e[19]=t("label",{class:"form-check-label",for:"visibility"},"Sichtbar",-1))])])],32)]),t("div",te,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[10]||(e[10]=l=>s.$emit("close"))},"Abbrechen"),t("button",{type:"button",class:"btn btn-primary",onClick:f,disabled:T.loading},w(T.loading?"Speichern...":"Speichern"),9,oe)])])]))}},ie=x(se,[["__scopeId","data-v-6e4e8f04"]]),le={class:"container-fluid py-3"},ne={class:"d-flex justify-content-between align-items-center mb-3"},ae={class:"mb-4"},re={key:0,class:"text-center py-4"},de={key:1,class:"text-center py-4"},ue={key:2,class:"row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-3"},me={key:3,class:"modal fade show",style:{display:"block"}},ve={__name:"AdminView",setup(T){const m=H(),a=y(!1),u=y([]),i=y({list:!1,save:!1,delete:!1}),f=y({title:"",date:"",startTime:"",duration:60,maxBookings:1,price:0,visibility:!0}),s=y({visibility:"all"}),e=M(()=>s.value.visibility==="all"?u.value:u.value.filter(n=>s.value.visibility==="visible"?n.visibility:!n.visibility)),l=async()=>{var n;i.value.list=!0;try{console.log("Fetching all events (including hidden) as admin...");const o=await k.getEvents(!0);console.log("Raw response:",o),Array.isArray(o)&&console.log("Sample event bookings:",(n=o[0])==null?void 0:n.bookings),u.value=Array.isArray(o)?o.map(r=>(console.log(`Event ${r.id} bookings:`,r.bookings),{...r,visibility:!!r.visibility,bookings:r.bookings||[]})):[],u.value.length>0&&(console.log("Events after processing:",u.value.map(r=>{var g;return{id:r.id,title:r.title,bookingsCount:((g=r.bookings)==null?void 0:g.length)||0,bookings:r.bookings}})),u.value.sort((r,g)=>new Date(r.startTime)-new Date(g.startTime)))}catch(o){console.error("Error fetching events:",o),m.error("Fehler beim Laden der Termine: "+o.message),u.value=[]}finally{i.value.list=!1}},b=n=>{f.value={...n},a.value=!0},$=n=>{console.log("Original item:",n);const o={title:`${n.title} (Kopie)`,date:n.date,startTime:n.startTime,duration:parseInt(n.duration)||60,maxBookings:parseInt(n.maxBookings)||1,price:parseFloat(n.price)||0,visibility:n.visibility!==!1,id:void 0,bookings:void 0,bookedSeats:void 0};if(console.log("Initial copy:",o),o.date&&o.startTime){const r=new Date(o.date),g=new Date(o.startTime);o.date=r.toLocaleDateString("sv").split("T")[0];const B=g.getHours().toString().padStart(2,"0"),I=g.getMinutes().toString().padStart(2,"0");o.startTime=`${B}:${I}`,console.log("Formatted date:",o.date),console.log("Formatted time:",o.startTime)}console.log("Final copy:",o),f.value=o,a.value=!0},h=async n=>{if(confirm("Möchten Sie diesen Termin wirklich löschen?")){i.value.delete=!0;try{await k.deleteEvent(n.id),m.success("Termin erfolgreich gelöscht"),await l()}catch(o){console.error("Error deleting event:",o),m.error("Fehler beim Löschen: "+o.message)}finally{i.value.delete=!1}}},E=async n=>{i.value.save=!0;try{n.id?(await k.updateEvent(n.id,n),m.success("Termin erfolgreich aktualisiert")):(await k.createEvent(n),m.success("Termin erfolgreich erstellt")),a.value=!1,await l()}catch(o){console.error("Error saving event:",o),m.error("Fehler beim Speichern: "+o.message)}finally{i.value.save=!1}};return l(),(n,o)=>(c(),p("div",le,[t("div",ne,[o[4]||(o[4]=t("h1",{class:"h3"},"Termine verwalten",-1)),t("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=r=>a.value=!0)},o[3]||(o[3]=[t("i",{class:"bi bi-plus-circle"},null,-1),C(" Neuer Termin ")]))]),t("div",ae,[d(t("select",{"onUpdate:modelValue":o[1]||(o[1]=r=>s.value.visibility=r),class:"form-select"},o[5]||(o[5]=[t("option",{value:"all"},"Alle Termine",-1),t("option",{value:"visible"},"Nur sichtbare",-1),t("option",{value:"hidden"},"Nur versteckte",-1)]),512),[[N,s.value.visibility]])]),i.value.list?(c(),p("div",re,o[6]||(o[6]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):e.value.length?(c(),p("div",ue,[(c(!0),p(U,null,A(e.value,r=>(c(),p("div",{key:r.id,class:"col"},[S(L,{event:r,loading:i.value.save||i.value.delete,"is-admin":!0,onEdit:b,onCopy:$,onDelete:h,onRefresh:l},null,8,["event","loading"])]))),128))])):(c(),p("div",de,o[7]||(o[7]=[t("p",{class:"text-muted mb-0"},"Keine Termine gefunden",-1)]))),a.value?(c(),p("div",me,[S(ie,{event:f.value,loading:i.value.save,onSave:E,onClose:o[2]||(o[2]=r=>a.value=!1)},null,8,["event","loading"])])):q("",!0)]))}},ge=x(ve,[["__scopeId","data-v-2e5be643"]]);export{ge as default};
